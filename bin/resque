#!/usr/bin/env ruby

require 'thor'
require 'resque'

class SampleJob
  def self.perform
    2 + 2
  end
end

class Resque
  class CLI < Thor

    desc "work", "Start processing jobs."
    method_option :queue, :default => :default, :aliases => ["-q"]
    def work
      resque = Resque.new(Resque::RedisQueue)
      loop do
        result = resque.process_job
        if result
          puts "PROCESSED JOB. RESULT: #{result}"
        end
      end
    end

    desc "test", "Test the queue"
    def test
      resque = Resque.new(Resque::RedisQueue)
      5.times do
        resque.enqueue(SampleJob)
      end
    end
  end
end

Resque::CLI.start
