#!/usr/bin/env ruby

require 'thor'
require 'resque'

class SampleJob
  def self.perform
    2 + 2
  end
end

class Resque
  class CLI < Thor

    desc "work", "Start processing jobs."
    def work
      producer = Thread.new do
        5.times do |i|
          Resque.enqueue(SampleJob)
        end
      end

      consumer = Thread.new do
        loop do
          if Resque.queue[:default].length == 0
            break
          end

          result = Resque.process_job
          puts "PROCESSED JOB. RESULT: #{result}"
        end
      end
      consumer.join
    end
  end
end

Resque::CLI.start
